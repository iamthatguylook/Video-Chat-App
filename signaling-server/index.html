<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>WebRTC Signaling Server Example</title>
	</head>
	<body>
		<h1>WebRTC Signaling Server Example</h1>
		<input type="text" id="room-input" placeholder="Enter Room Name" />
		<button onclick="joinRoom()">Join Room</button>
		<button onclick="disconnectRoom()">Disconnect</button>
		<video id="local-video" autoplay></video>
		<div id="remote-videos"></div>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.3/socket.io.js"></script>
		<script>
			// app.js
			const socket = io();

			const remoteVideosContainer = document.getElementById("remote-videos");
			let localStream;
			async function joinRoom() {
				let constraints = {
					video: {
						width: { min: 640, ideal: 1920, max: 1920 },
						height: { min: 480, ideal: 1080, max: 1080 },
					},
					audio: true,
				};

				const room = document.getElementById("room-input").value;
				try {
					localStream = await navigator.mediaDevices.getUserMedia(constraints);
					document.getElementById("local-video").srcObject = localStream;

					// localStream = await navigator.mediaDevices.getUserMedia(constraints);
					// localVideo.srcObject = localStream;

					// Join the room and notify the signaling server
					console.log(room);
					socket.emit("join-room", room);

					// Listen for new users joining the room
					socket.on("user-joined", (userId) => {
						console.log("User joined:", userId);
					});
					socket.on("current-users", (usersId) => {
						const users = usersId;
						console.log(`the socket belongs ${socket.id}`);
						console.log(`users list ${users}`); // all the users in the socket

						const userIndex = users.indexOf(socket.id);
						if (userIndex > -1) {
							users.splice(userIndex, 1); // Remove current user from list of users
						}

						console.log(`users list after removal ${users}`);
						console.log(users[Math.floor(Math.random() * users.length)]); //random user to send offer to in the list
					});
				} catch (error) {
					console.error("Error accessing media devices:", error);
				}
			}
			async function disconnectRoom() {
				try {
					const room = document.getElementById("room-input").value;
					// localStream = await navigator.mediaDevices.getUserMedia(constraints);
					// localVideo.srcObject = localStream;

					// Join the room and notify the signaling server

					socket.emit("leave-room", room);
				} catch (error) {
					console.error("Error accessing media devices:", error);
				}
			}
		</script>
	</body>
</html>
